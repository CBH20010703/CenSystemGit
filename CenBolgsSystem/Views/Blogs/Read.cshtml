@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Read</title>
    <link href="~/Scripts/layui-v2.5.5/css/layui.css" rel="stylesheet" />
    <link href="~/Content/blogs/message.css" rel="stylesheet" />
    <link href="~/Content/blogs/nprogress.css" rel="stylesheet" />
    <link href="~/Content/blogs/master.css" rel="stylesheet" />
    <link href="~/Content/blogs/gloable.css" rel="stylesheet" />
    <link href="~/Content/blogs/blog.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Content/editormd/css/editormd.css" />
    <script src="~/Scripts/blogs/jq.min.js"></script>
    <script src="~/Content/editormd/lib/marked.min.js"></script>
    <script src="~/Content/editormd/lib/prettify.min.js"></script>
    <script src="~/Content/editormd/lib/raphael.min.js"></script>
    <script src="~/Content/editormd/lib/underscore.min.js"></script>
    <script src="~/Content/editormd/lib/sequence-diagram.min.js"></script>
    <script src="~/Content/editormd/lib/flowchart.min.js"></script>
    <script src="~/Content/editormd/lib/jquery.flowchart.min.js"></script>
    <script src="~/Scripts/jquery.cookie.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="header">
    </div>
    <header class="gird-header">
        <div class="header-fixed">
            <div class="header-inner">
                <a href="javascript:void(0)" class="header-logo" id="logo">Mr.cen</a>
                <nav class="nav" id="nav">
                    <ul>
                        <li><a href="/Blogs/blogs">首页</a></li>
                        <li><a href="/Blogs/index">博客</a></li>
                        <li><a href="#">留言</a></li>
                        <li><a href="#">日记</a></li>
                        <li><a href="#">友链</a></li>
                    </ul>
                </nav>
                <a href="#" class="blog-user">
                    <i class="fa fa-qq"></i>
                </a>
                <a class="phone-menu">
                    <i></i>
                    <i></i>
                    <i></i>
                </a>
            </div>
        </div>
    </header>
    <div class="doc-container" id="doc-container">
        <div class="container-fixed">
            <div class="col-content" style="width:100%">
                <div class="inner">
                    <article class="article-list">
                        <input type="hidden" value="" id="blogtypeid" />
                        <section class="article-item">
                            <aside class="title" style="line-height:1.5;">
                                <h4 id="Admin-title">Java学习路线推荐</h4>
                                <p class="fc-grey fs-14">
                                    <small>
                                        作者：<a href="javascript:void(0)" target="_blank" class="fc-link">小岑</a>
                                    </small>
                                    <small class="ml10">围观群众：<i class="readcount">121</i></small>
                                    <small class="ml10">更新于 <label id="Admin-date">2020-07-1:11:20:21</label> </small>
                                </p>

                            </aside>
                            <div id="AdminTime" class="time mt10" style="padding-bottom:0;">
                                <span class="day">1</span>
                                <span class="month fs-18">7<small class="fs-14">月</small></span>
                                <span class="year fs-18">2020</span>
                            </div>

                            <div class="content artiledetail" style="border-bottom: 1px solid #e1e2e0; padding-bottom: 20px;">
                                <div id="test-editormd">
                                    <textarea id="message" name="message">
                                        
                                    </textarea>
                                </div>
                                <div class="copyright mt20">
                                    <p class="f-toe fc-black">
                                        非特殊说明，本文版权归 Cen个人博客 所有，转载请注明出处.
                                    </p>
                                    <p class="f-toe">
                                        本文标题：
                                        <a href="javascript:void(0)" id="footer-title" class="r-title"></a>
                                    </p>
                                    <p class="f-toe">
                                        本文网址：
                                        <a href="#">暂无</a>
                                    </p>
                                </div>
                                <div id="aplayer" style="margin:5px 0"></div>
                                <h6>延伸阅读</h6>
                                <ol class="b-relation"></ol>
                            </div>
                            <form class="layui-form layui-form-pane" action="">
                                <div class="layui-form-item layui-form-text">
                                    <label class="layui-form-label">留言</label>
                                    <div class="layui-input-block">
                                        <textarea placeholder="请输入内容"  id="Leave_text" name="leave_content" lay-verify="required" class="layui-textarea"></textarea>
                                    </div>
                                </div>
                                <button class="layui-btn" lay-submit="demo1" lay-filter="demo2">提交留言</button>
                            </form>
                            <ul class="message-list" id="message-list">
                            </ul>
                            <div class="bdsharebuttonbox share" data-tag="share_1">
                                <ul>
                                    <li class="f-praise"><i class="fa fa-weixin"></i></li>
                                    <li class="f-weinxi"><i class="fa fa-weibo"></i></li>
                                    <li class="f-sina"><i class="fa fa-github-square"></i></li>
                                    <li class="f-qq" href="#"><i class="fa fa-qq"></i></li>
                                    <li class="f-qzone"><i class="fa fa-connectdevelop"></i></li>
                                </ul>
                            </div>
                            <div class="f-cb"></div>
                            <div class="mt20 f-fwn fs-24 fc-grey comment" style="border-top: 1px solid #e1e2e0; padding-top: 20px;">
                            </div>
                        </section>
                    </article>
                </div>
            </div>
        </div>
    </div>
    <footer class="grid-footer">
        <div class="footer-fixed">
            <div class="copyright">
                <div class="info">
                    <div class="contact">
                        <a href="javascript:void(0)" class="github" target="_blank"><i class="fa fa-github"></i></a>
                        <a href="#" class="qq" target="_blank"><i class="fa fa-qq"></i></a>
                        <a href="#" class="email" target="_blank"><i class="fa fa-envelope"></i></a>
                        <a href="javascript:void(0)" class="weixin"><i class="fa fa-weixin"></i></a>
                    </div>
                    <p class="mt05">
                        Copyright &copy; 2019-2020 Cen博客 All Rights Reserved V.3.1.3 Power by ZQ博客
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="~/Scripts/layui-v2.5.5/layui.js"></script>
    <script src="~/Content/editormd/editormd.min.js"></script>
    <script src="~/Scripts/blogs/plugins/nprogress.js"></script>
    <script src="~/Scripts/blogs/yss/gloable.js"></script>
    <script>NProgress.start();</script>
    <script>

                    function AddLeave() {
                        $.ajax({
                            type: "post",
                            data: { leave_articleId: window.location.search.substring(decodeURIComponent(window.location.search).indexOf("=") + 1) },
                            url: "/Blogs/SelectArticleLeave",
                            success: function (data) {
                                console.log(data)
                                $("#Leave_text").html("");
                                $("#message-list").html("")
                                for (var i = data.data.length-1; i >= 0 ; i--) {
                                    $("#message-list").append(
                                        `
                               <li class="zoomIn article" style="border-bottom: 1px solid #000;">
                                                    <div class="comment-parent">
                                                        <a name="remark-1"></a>
                                                        <img src="${data.data[i].user_ImgUrl}" />
                                                        <div class="info">
                                                            <span class="username">${data.data[i].user_Name}</span>
                                                        </div>
                                                        <div class="comment-content">
                                                            ${data.data[i].leave_content}
                                                        </div>
                                                        <p class="info info-footer">
                                                            <i class="fa fa-map-marker" aria-hidden="true"></i>
                                                            <span>深圳</span>
                                                            <span class="comment-time"> ${data.data[i].leave_creatdatetime}</span>
                                                            <!-- <a href="javascript:;" class="btn-reply" data-targetid="1" data-targetname="冰">回复</a> -->
                                                        </p>
                                                    </div>
                                 </li>
                                    `
                                    )
                                }
                            }, error: function (error) {
                                layer.msg("网络链接中断", { icon: 2 })
                            }
                            })
                        };

            AddLeave()
            function isEmpty(value) {
            return (Array.isArray(value) && value.length === 0)
                || (Object.prototype.isPrototypeOf(value) && Object.keys(value).length === 0);
        }
        window.onload = function () {
            NProgress.done();
        };

        $(function () {
            var textarea;
            textarea = editormd.markdownToHTML("test-editormd", {
                width: "90%"
                , height: 700
                , path: "/Content/editormd/lib"
                , preview: true
                , wacth: true
                , editor: false
                , htmlDecode: "style,script,iframe",
                markdown: Getmd().article_MakHtml
            })

            function Getmd() {
                let temp;
                $.ajax({
                    type: "get",
                    url: "/Blogs/GetReadArticle",
                    async: false,
                    data: { article_Id: window.location.search.substring(decodeURIComponent(window.location.search).indexOf("=") + 1) },
                    success: function (data) {
                        console.log(data)
                        $("#footer-title").html(data.data.article_Title)
                        $("#Admin-title").html(data.data.article_Title)

                        let dataArr = data.data.article_CreatDateTime.split("-")

                        $("#AdminTime>span").each(function (item) {

                            if (item == 0) {
                                console.log(dataArr.reverse()[item].indexOf(" "))
                                console.log()
                                $(this).html(dataArr.reverse()[item].substring(0, dataArr.reverse()[item].indexOf(" ")))
                            }

                            $(this).html(dataArr.reverse()[item])
                            if (item == 2) {

                                $(this).html(dataArr[item].substring(0, dataArr[item].indexOf(" ")))
                            }
                        })
                        temp = data.data

                    },
                })
                return temp
            };
                // $.cookie（"cookie名字"） 获取
            layui.use("form", function () {
                let form = layui.form;
                form.on("submit(demo2)", function (data) {
                    if ($.cookie("UserId") == undefined) {
                        layer.msg("未登录无法评论文章,请先登录后在进行评论", { icon: 1 }, function () {
                            // 截取当前 window location 对象地址截取最好一个/存在sessionStorage里面  特点 关闭浏览器就会消失
                            //LocationUrl 获取方式sessionStorage.getItem("LocationUrl")
                            window.sessionStorage.setItem("LocationUrl", window.location.href.substring(window.location.href.lastIndexOf("/")))
                            window.location.href="/User/Index"
                        });
                        return false;
                    }
                    window.sessionStorage.removeItem("LocationUrl");
                    data.field.leave_articleId = window.location.search.substring(decodeURIComponent(window.location.search).indexOf("=") + 1);
                    data.field.leave_userId = $.cookie("UserId");
                        $.ajax({
                            type: "post",
                            data: data.field,
                            url: "/Blogs/UserAddLeave",
                            dataType:"json",
                            success: function (data) {
                                console.log(data)
                                if (data.code == 0) {

                                    layer.msg(data.msg, { icon: 1 })
                                    AddLeave()
                                    return;
                                }
                                layer.msg(data.msg, { icon: 2 })
                            }
                        })



                    //
                    return false;
                })
                console.log(form);
            })
        })
    </script>
</body>
</html>
